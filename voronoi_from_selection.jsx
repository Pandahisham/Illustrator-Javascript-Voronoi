//  voronoi_from_selection.jsx//  draws voronoi diagrams in illustrator//  using the javascript port from//  gorhill --> https://github.com/gorhill //  you can find the code here://  https://github.com/gorhill/Javascript-Voronoi//  under the same license as this one//  the illustrator usage can be found here://  https://github.com/fabiantheblind/Javascript-Voronoi//  the direct download is here: //  https://github.com/fabiantheblind/Javascript-Voronoi/zipball/master//~ Copyright (c)  2012 Fabian "fabiantheblind" Morón Zirfas//~ Permission is hereby granted, free of charge, to any person obtaining a copy of this//~ software and associated documentation files (the "Software"), to deal in the Software //~ without restriction, including without limitation the rights to use, copy, modify, //~ merge, publish, distribute, sublicense, and/or sell copies of the Software, and to //~ permit persons to whom the Software is furnished to do so, subject to the following //~ conditions://~ The above copyright notice and this permission notice shall be included in all copies //~ or substantial portions of the Software.//~ THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, //~ INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A //~ PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT //~ HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF //~ CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE //~ OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.//~ see also http://www.opensource.org/licenses/mit-license.php#include "rhill-voronoi-core.js"var DEBUG = false;main();function main(){var sites;// will be filled with pointserror0 = "Please open a document";error1 = "Please select at least one non-compound path item";error2 = "Please release all groups and compound path items";if ( app.documents.length == 0 ) {  alert(error0);return;}// if (doc.selection.length == 0){//   alert(error1);//   return;// }// ------------ the new doc ------------var docPreset = new DocumentPreset;docPreset.units = RulerUnits.Pixels;docPreset.width = app.activeDocument.width;docPreset.height = app.activeDocument.height;// ------------ duplicate selection to new doc ------------var newItem;var docSelected = app.activeDocument.selection;var doc =  app.documents.addDocument("newFile",docPreset);if ( docSelected.length > 0 ) {for ( i = 0; i < docSelected.length; i++ ) {    docSelected[i].selected = false;    newItem = docSelected[i].duplicate( doc,ElementPlacement.PLACEATEND );    }   } else {  docSelected.selected = false;  newItem = docSelected.parent.duplicate( doc,ElementPlacement.PLACEATEND );  } // ------------ set the ruler origin ------------var rulerPrefVal = app.preferences.getBooleanPreference("isRulerOriginTopLeft");app.preferences.setBooleanPreference ("isRulerOriginTopLeft",true);redraw();// ------------ now make outlines, release all groups and compund paths ------------if(doc.textFrames.length > 0){  create_outlines(doc);}if(doc.groupItems.length > 0){ungroup(doc.layers[0]);}if(doc.compoundPathItems.length > 0){release(doc);}var sites = get_pathPoints(doc);  // this is the basic example by gorhill  // var sites = [{x:300,y:300}, {x:100,y:100}, {x:200,y:500}, {x:250,y:450}, {x:500,y:150}];  // xl, xr means x left, x right  // yt, yb means y top, y bottom  var bbox = {xl:0, xr:doc.width, yt:0, yb:doc.height};  // pass an object which exhibits xl, xr, yt, yb properties. The bounding  // box will be used to connect unbound edges, and to close open cells        // var sites = get_pathPoints(doc);    var voronoi = new Voronoi();    result = voronoi.compute(sites, bbox);    var lyr = doc.layers.add();     lyr.name = "diagram";    doc.layers[1].name = "original paths";    doc.layers[1].locked = true;    doc.layers[1].visible = false; //~ var doc = app.documents.add(//~                 DocumentColorSpace.RGB,//~                 cm2pt (80),//~                 cm2pt (60),//~                 1,//~                 DocumentArtboardLayout.GridByRow,//~                 20.0,//~                 3);//~  draw_cells (result); draw_edges (doc, result); // ------------ restore the ruler preferences ------------app.preferences.setBooleanPreference ("isRulerOriginTopLeft",rulerPrefVal);}      function create_outlines(doc){while(doc.textFrames.length > 0){  try{doc.textFrames[0].createOutline();    redraw();  }catch(e){    if(DEBUG)alert(e);    }  }  }function draw_edges(doc, result){         var edges = new Array();for(var i in result.edges){     var pt = new Array();  var va = new Array(result.edges[i].va.x, result.edges[i].va.y);  var vb = new Array(result.edges[i].vb.x, result.edges[i].vb.y);  pt.push(new Array(va[0],va[1]));  pt.push(new Array(vb[0],vb[1]));  edges.push({"path":pt});  }for(var k in edges){var path = doc.pathItems.add();redraw();  path.setEntirePath(edges[k].path);  }var diam = 3;for(var l in result.cells){    var top = -result.cells[l].site.y;    var left = result.cells[l].site.x;    redraw();        var ell = doc.pathItems.ellipse( -top + diam/2, left -diam/2, diam, diam, true,true );    }}function cm2pt(val){    var result = val * 28.346;    return result;    }function get_pathPoints(lyr){    // var sites = [{x:300,y:300}, {x:100,y:100}, {x:200,y:500}, {x:250,y:450}, {x:500,y:150}];  var list = new Array();  for(var j = 0; j < lyr.pathItems.length;j++){    var path = lyr.pathItems[j];    var points = path.pathPoints;  for (var i = 0; i < points.length; i++) {    var p = points[i];    var a = p.anchor;    var px = a[0];    var py = a[1];     list.push({x:px,y:py});  };}return list;}// ------------ release compound Paths ------------// this is coming from here// http://forums.adobe.com/message/2140054function release(doc){while(doc.compoundPathItems.length > 0){  try{release_compoundPath(doc);}catch(e){alert(e);}  }}function release_compoundPath(doc){  redraw();var cp = doc.compoundPathItems[0];var p = cp.pathItems[0];  p.move(doc, ElementPlacement.PLACEATEND);}// ------------ release text compound paths ------------function release_TextCP(doc, item){while(item.compoundPathItems.length > 0){  var cp = item.compoundPathItems[0];  try{ release_one_compoundPath(doc, cp); }catch(e){if(DEBUG)alert(e);}}  }function release_one_compoundPath(doc, cp){  redraw();var this_cp = cp;var p = this_cp.pathItems[0];  p.move(doc, ElementPlacement.PLACEATEND);}// ------------ insept properties and methods ------------// the functions below are// by Peter the Magnificant Kahrel// http://www.kahrel.plus.com/indesign/scriptui.html// look under "Displaying properties and methods"function  util_inspect_properties (f) {$.writeln (f.reflect.name);var props = f.reflect.properties;var array = [];for (var i = 0; i < props.length; i++)try {array.push (props[i].name + ": " + f[props[i].name])} catch (_){} array.sort ();$.writeln (array.join ("\r"));}function util_inspect_methods (m) {var props = m.reflect.methods.sort(); $.writeln ("\rMethods");for (var i = 0; i < props.length; i++)$.writeln (props[i].name);}// ------------ ------------/** *  all group to ungroup v.1 - CS, CS2,CS3,CS4,CS5 * *  Author: Nokcha (netbluew@gmail.com) *   *  This Script  is Can be easily  ungrouping to all group items in the Document. * * * JS code (c) copyright: Jiwoong Song ( netbluew@nate.com ) * Copyright (c) 2009 netbluew@nate.com * All rights reserved. * * This code is derived from software contributed to or originating on wundes.com * * * Redistribution and use in source and binary forms, with or without * modification, are permitted provided that the following conditions * are met: * 1. Redistributions of source code must retain the above copyright *    notice, this list of conditions and the following disclaimer. * 2. Redistributions in binary form must reproduce the above copyright *    notice, this list of conditions and the following disclaimer in the *    documentation and/or other materials provided with the distribution. * 3. All advertising materials mentioning features or use of this software *    must display the following acknowledgement: *        This product includes software developed by netbluew@nate.com *        and its contributors. * 4. Neither the name of wundes.com nor the names of its *    contributors may be used to endorse or promote products derived *    from this software without specific prior written permission. * * THIS SOFTWARE IS PROVIDED BY WUNDES.COM AND CONTRIBUTORS * ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE FOUNDATION OR CONTRIBUTORS * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE * POSSIBILITY OF SUCH DAMAGE. */// var doc;// var itemKinds = new Array("pathItems","compoundPathItems","textFrames","placedItems","rasterItems","meshItems","pluginItems","graphItems","symbolItems","groupItems");function getChildAll(obj){  var childsArr = new Array();  for(var i=0;i<obj.pageItems.length;i++)childsArr.push(obj.pageItems[i]);  return childsArr;}function ungroup(obj){  var elements = getChildAll(obj);  if(elements.length<1){    obj.remove();    return;  }else{    for(var i=0;i<elements.length;i++)    {      try{        if(elements[i].parent.typename!="Layer")elements[i].moveBefore(obj);        if(elements[i].typename=="GroupItem")ungroup(elements[i]);      }catch(e){      }    }  }}// if(app.activeDocument)// {//  doc = app.activeDocument;//  if(doc.groupItems.length)for(var i=0;i<doc.layers.length;i++)ungroup(doc.layers[i]);// }